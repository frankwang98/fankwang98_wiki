






基于STM32来复习以下常用的C语言知识。




#### 文章目录


* + [位操作](#_3)
	+ - [1.对某些位进行设值（& |）](#1__10)
		- [2.移位操作提高代码可读性](#2_23)
		- [3.取反操作](#3_39)
	+ [宏定义](#_52)
	+ [ifdef条件编译](#ifdef_60)
	+ [extern变量声明](#extern_71)
	+ [typedef类型别名](#typedef_94)
	+ [结构体](#_111)




### 位操作


计算机的位是Bit，即数字在计算机中的二进制表示（0和1）。十六进制用于缩写二进制，将二进制从后向前每4位数转换为1位十六进制。


C语言支持6种位操作：


![在这里插入图片描述](https://img-blog.csdnimg.cn/60012290ca1946afb89189acb88954a8.png)


#### 1.对某些位进行设值（& |）


改变 GPIOA 的状态，对寄存器的值进行&清零操作：



```
GPIOA->CRL&=0XFFFFFF0F; //将第 4-7 位清 0

```

再与需要设置的值进行|或运算：



```
GPIOA->CRL|=0X00000040; //设置相应位的值，不改变其他位的值

```

#### 2.移位操作提高代码可读性


某些时候，直接赋值操作可读性不强，就是看代码的人不知道你要干什么，而移位操作就能很清晰地表达想法：


如将 BSRR 寄存器的第 pinpos 位设置为 1：



```
GPIOx->BSRR = (((uint32\_t)0x01) << pinpos);

```

再如将第6个端口设置高位：



```
GPIOA->ODR|=1<<5; //PA.5 输出高,不改变其他位

```

5 告诉我们是第 5 位也就是第 6 个端口，1 告诉我们是设置为 1 了。


#### 3.取反操作


SR 寄存器的每一位都代表一个状态，某个时刻我们希望去设置某一位的值为 0，同时其他位都保留为 1，简单的作法是直接给寄存器设置一个值：



```
TIMx->SR=0xFFF7；	//第3位设置为0

```

但这样可读性差，在库函数中可以这样表示：



```
TIMx->SR = (uint16\_t)~TIM_FLAG;	//TIM\_FLAG是宏定义的值

```

这样可以直接对第3位取0。


### 宏定义


define 是 C 语言中的预处理命令，它用于宏定义，可以提高源代码的可读性，为编程提供方便。格式如下：



```
#define 标识符 字符串
#define SYSCLK\_FREQ\_72MHz 72000000 //定义72MHz

```

### ifdef条件编译


当满足条件时对一组语句进行编译，否则对另一段语句进行编译：



```
#ifdef 标识符
程序段 1 
#else 
程序段 2 
#endif

```

### extern变量声明


C 语言中 extern 可以置于变量或者函数前，以表示变量或者函数的定义在别的文件中，提示编译器遇到此变量和函数时在其他模块中寻找其定义。这里面要注意，对于 extern 申明变量可以多次，但定义只有一次。如：



```
//定义
u8 id;//定义只允许一次
main()
{
id=1;
printf("d%",id);//id=1
test();
printf("d%",id);//id=2
}

```


```
//申明
extern u8 id;//申明变量 id 是在外部定义的，申明可以在很多个文件中进行
void test(void){
id=2;
}

```

### typedef类型别名


typedef 用于为现有类型创建一个新的名字，或称为类型别名，用来简化变量的定义。typedef 在 MDK 用得最多的就是定义结构体的类型别名和枚举类型。



```
//定义结构体变量
typedef struct
{
 __IO uint32\_t CRL;
 __IO uint32\_t CRH;
…
} GPIO_TypeDef;

```


```
GPIO_TypeDef _GPIOA,_GPIOB;

```

### 结构体


结构体简单来说就是将不同类型的变量组合在一起。定义如下：



```
Struct 结构体名{
成员列表;
}变量名列表；

```

例如，申明结构体并定义变量：



```
Struct U_TYPE {
Int BaudRate
Int WordLength; 
}usart1,usart2;

```

以上。





