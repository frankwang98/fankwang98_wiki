







> 
> ğŸ˜*â˜…,Â°*:.â˜†(ï¿£â–½ï¿£)/$:*.Â°â˜…* ğŸ˜  
>  è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»cpp-tboxç™¾å®ç®±ç»„ä»¶åº“ã€‚  
>  **æ— ä¸“ç²¾åˆ™ä¸èƒ½æˆï¼Œæ— æ¶‰çŒåˆ™ä¸èƒ½é€šã€‚ã€‚â€”â€”æ¢å¯è¶…**  
>  æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œä¸€èµ·å­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚  
>  å–œæ¬¢çš„æœ‹å‹å¯ä»¥å…³æ³¨ä¸€ä¸‹ï¼Œä¸‹æ¬¡æ›´æ–°ä¸è¿·è·¯ğŸ¥
> 
> 
> 




#### æ–‡ç« ç›®å½•


* + [:smirk:1. é¡¹ç›®ä»‹ç»](#smirk1__7)
	+ [:blush:2. å®‰è£…è¿è¡Œ](#blush2__28)
	+ [:satisfied:3. è¿›é˜¶ä½¿ç”¨](#satisfied3__42)




### ğŸ˜1. é¡¹ç›®ä»‹ç»


é¡¹ç›®Githubåœ°å€ï¼š`https://github.com/cpp-main/cpp-tbox`


cpp-tbox æ˜¯ä¸€ä¸ªè·¨å¹³å°ã€è½»é‡çº§çš„ C++ å·¥å…·åº“ï¼Œæ—¨åœ¨æä¾›ä¸°å¯Œçš„å¸¸ç”¨åŠŸèƒ½å’Œä¾¿æ·çš„ç¼–ç¨‹æ¥å£ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯ç®€å•æ˜“ç”¨ã€é«˜æ•ˆå¯é ï¼Œå¹¶ä¸”å…·æœ‰è¾ƒä½çš„èµ„æºæ¶ˆè€—ã€‚


ä»¥ä¸‹æ˜¯ cpp-tbox çš„ä¸€äº›ç‰¹ç‚¹å’ŒåŠŸèƒ½ï¼š



> 
> 1.è·¨å¹³å°æ”¯æŒï¼šcpp-tbox å¯ä»¥åœ¨å¤šä¸ªä¸»æµæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼ŒåŒ…æ‹¬ Windowsã€Linuxã€Macç­‰ã€‚å®ƒå°è£…äº†æ“ä½œç³»ç»Ÿç›¸å…³çš„åŠŸèƒ½ï¼Œæä¾›äº†ç»Ÿä¸€çš„æ¥å£ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨ä¸åŒçš„å¹³å°ä¸‹å†™å‡ºå¯ç§»æ¤çš„ä»£ç ã€‚
> 
> 
> 



> 
> 2.çº¿ç¨‹å’Œå¹¶å‘æ”¯æŒï¼šcpp-tbox æä¾›äº†çº¿ç¨‹ç®¡ç†ã€äº’æ–¥é”ã€æ¡ä»¶å˜é‡ç­‰åŸºç¡€çš„çº¿ç¨‹å’Œå¹¶å‘åŠŸèƒ½ã€‚ä½ å¯ä»¥ä½¿ç”¨ cpp-tbox æ¥åˆ›å»ºå’Œæ§åˆ¶çº¿ç¨‹ï¼Œè¿›è¡Œçº¿ç¨‹åŒæ­¥å’Œäº’æ–¥æ“ä½œï¼Œå®ç°å¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹ã€‚
> 
> 
> 



> 
> 3.å†…å­˜ç®¡ç†ï¼šcpp-tbox æä¾›äº†å†…å­˜ç®¡ç†çš„å·¥å…·å’Œæ¥å£ï¼Œå¸®åŠ©ä½ æ›´æ–¹ä¾¿åœ°è¿›è¡Œå†…å­˜åˆ†é…å’Œé‡Šæ”¾ã€‚å®ƒå°è£…äº†å¸¸ç”¨çš„å†…å­˜æ“ä½œï¼Œå¦‚åŠ¨æ€å†…å­˜åˆ†é…ã€å†…å­˜å¯¹é½ã€å†…å­˜æ‹·è´ç­‰ï¼Œæä¾›äº†å®‰å…¨å’Œé«˜æ•ˆçš„å†…å­˜ç®¡ç†åŠŸèƒ½ã€‚
> 
> 
> 



> 
> 4.å¸¸ç”¨æ•°æ®ç»“æ„å’Œç®—æ³•ï¼šcpp-tbox å®ç°äº†è®¸å¤šå¸¸ç”¨çš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œå¦‚åŠ¨æ€æ•°ç»„ã€é“¾è¡¨ã€å“ˆå¸Œè¡¨ã€å †ç­‰ã€‚å®ƒä»¬è¢«è®¾è®¡ä¸ºé«˜æ•ˆå’Œæ˜“ç”¨çš„ï¼Œå¯ä»¥æ»¡è¶³å„ç§åœºæ™¯ä¸‹çš„éœ€æ±‚ã€‚
> 
> 
> 



> 
> 5.æ–‡ä»¶å’ŒIOæ“ä½œï¼šcpp-tbox æä¾›äº†ä¾¿æ·çš„æ–‡ä»¶å’ŒIOæ“ä½œæ¥å£ï¼Œä½¿å¾—æ–‡ä»¶å¤„ç†å’ŒIOæ“ä½œå˜å¾—æ›´ç®€å•ã€‚ä½ å¯ä»¥ä½¿ç”¨ cpp-tbox æ¥è¯»å†™æ–‡ä»¶ã€åˆ›å»ºç›®å½•ã€éå†æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚
> 
> 
> 



> 
> 6.å­—ç¬¦ä¸²æ“ä½œï¼šcpp-tbox å°è£…äº†å¸¸è§çš„å­—ç¬¦ä¸²å¤„ç†æ“ä½œï¼Œå¦‚æ‹†åˆ†ã€è¿æ¥ã€æ ¼å¼åŒ–ç­‰ã€‚å®ƒè¿˜æä¾›äº†æ­£åˆ™è¡¨è¾¾å¼çš„æ”¯æŒï¼Œä½¿å¾—å­—ç¬¦ä¸²åŒ¹é…å’Œæ›¿æ¢æ›´æ–¹ä¾¿ã€‚
> 
> 
> 



> 
> 7.æ—¶é—´å’Œæ—¥æœŸå¤„ç†ï¼šcpp-tbox æä¾›äº†æ—¶é—´å’Œæ—¥æœŸç›¸å…³çš„åŠŸèƒ½ï¼Œå¦‚è·å–å½“å‰æ—¶é—´ã€è®¡ç®—æ—¶é—´å·®ã€æ—¥æœŸæ ¼å¼åŒ–ç­‰ã€‚å®ƒè¿˜æ”¯æŒæ—¶åŒºè½¬æ¢ï¼Œä»¥åŠå¸¸è§çš„æ—¶é—´å’Œæ—¥æœŸæ“ä½œã€‚
> 
> 
> 


### ğŸ˜Š2. å®‰è£…è¿è¡Œ


ç¼–è¯‘è¿è¡Œï¼š



```
cd cpp-tbox
# makeç¼–è¯‘
make 3rd-party modules RELEASE=1 STAGING\_DIR=$HOME/.tbox
# cmakeç¼–è¯‘
cmake -B build -DCMAKE\_INSTALL\_PREFIX=$HOME/.tbox
# å®Œæˆä¹‹åï¼Œå¤´æ–‡ä»¶ä¸åº“æ–‡ä»¶éƒ½åœ¨ $HOME/.tbox è·¯å¾„ä¸‹

```

å¦å¤–ï¼Œè¿™ä¸ªå¼€æºé¡¹ç›®ä¹Ÿé…å¥—äº†ä½¿ç”¨æ•™ç¨‹ï¼š`https://gitee.com/cpp-master/cpp-tbox-tutorials/blob/master/README.md`


æˆ‘å·²ç»è·Ÿç€èµ°äº†ä¸€éï¼Œæ„Ÿè§‰è¿˜æ˜¯ä¸é”™çš„ï¼Œå¯ä»¥å­¦åˆ°ä¸€äº›ä¸œè¥¿ã€‚


### ğŸ˜†3. è¿›é˜¶ä½¿ç”¨


ä¸€ä¸ªåŸºæœ¬çš„åŸºäºreactoräº‹ä»¶çš„è¿›ç¨‹ï¼š



```
#include <tbox/main/main.h>

namespace app1 {

class App : public tbox::main::Module
{
  public:
    App(tbox::main::Context &ctx);
    ~App();

  protected:
    virtual bool onInit(const tbox::Json &cfg) override;
    virtual bool onStart() override;
    virtual void onStop() override;
    virtual void onCleanup() override;
};

}

```

Makefileç¤ºä¾‹ï¼š



```
TARGET:=demo

OBJECTS:=app_main.o

CXXFLAGS:=-I$(HOME)/.tbox/include -DLOG\_MODULE\_ID='"demo"'
LDFLAGS:=-L$(HOME)/.tbox/lib -rdynamic
LIBS:=\
	-ltbox\_main \
	-ltbox\_terminal \
	-ltbox\_network \
	-ltbox\_eventx \
	-ltbox\_event \
	-ltbox\_log \
	-ltbox\_util \
	-ltbox\_base \
	-lpthread -ldl

$(TARGET): $(OBJECTS)
	g++ -o $@ $^ $(LDFLAGS) $(LIBS)

clean:
	rm *.o

```

ä¸€ä¸ªæ‰“å°æ—¥å¿—çš„ç¤ºä¾‹ï¼š



```
#include <tbox/main/module.h>
#include <tbox/base/log.h>

#include <iostream>

class MyModule : public tbox::main::Module {
  public:
    explicit MyModule(tbox::main::Context &ctx) : tbox::main::Module("my", ctx) { }
    virtual ~MyModule() { }

  public:
    virtual bool onInit(const tbox::Json &js) override { 
      // ç­‰çº§ã€æ—¶é—´ç‚¹ã€çº¿ç¨‹å·ã€æ¨¡å—åã€å‡½æ•°åã€å†…å®¹ã€æ–‡ä»¶åï¼šè¡Œå·
      std::cout << "======= Start print log!" << std::endl;
      LogFatal("this is fatal log");
      LogErr("this is error log");
      LogWarn("this is warn log");
      LogInfo("this is info log");
      LogDbg("this is debug log");
      return true; 
    }
    virtual bool onStart() override { LogTag(); return true; }
    virtual void onStop() override { LogTag(); }
    virtual void onCleanup() override { LogTag(); }
};

namespace tbox {
namespace main {
void RegisterApps(Module &apps, Context &ctx) {
  apps.add(new MyModule(ctx));
  std::cout << "======= Start print log2!" << std::endl;
}
}
}

```

ä¸€ä¸ªå®šæ—¶å™¨äº‹ä»¶ï¼š



```
#include <tbox/main/module.h>
#include <tbox/base/log.h>
#include <tbox/event/timer\_event.h> /// å¯¼å…¥TimerEventç±»

class MyModule : public tbox::main::Module {
  public:
    explicit MyModule(tbox::main::Context &ctx)
        : tbox::main::Module("my", ctx)
        , tick\_timer\_(ctx.loop()->newTimerEvent())    /// å®ä¾‹åŒ–å®šæ—¶å™¨å¯¹è±¡
    { }

    virtual ~MyModule() { delete tick_timer_; } /// é‡Šæ”¾å®šæ—¶å™¨å¯¹è±¡

  public:
    virtual bool onInit(const tbox::Json &js) override {
        /// åˆå§‹åŒ–ï¼Œè®¾ç½®å®šæ—¶é—´éš”ä¸º1sï¼ŒæŒç»­è§¦å‘
        tick_timer_->initialize(std::chrono::seconds(1), tbox::event::Event::Mode::kPersist); // kPersist kOneshot
        /// è®¾ç½®å®šæ—¶å™¨è§¦å‘æ—¶çš„å›è°ƒ
        tick_timer_->setCallback([this] { onTick(); });
        return true;
    }
    /// å¯åŠ¨
    virtual bool onStart() {
        tick_timer_->enable();
        return true;
    }
    /// åœæ­¢
    virtual void onStop() {
        tick_timer_->disable();
    }

  private:
    void onTick() {
        ++count_;
        LogDbg("count:%d", count_);
    }

  private:
    tbox::event::TimerEvent \*tick_timer_;
    int count_ = 0;
};

namespace tbox {
namespace main {
void RegisterApps(Module &apps, Context &ctx) {
  apps.add(new MyModule(ctx));
}
}
}

```

ä¸€ä¸ªä¿¡å·äº‹ä»¶çš„å¤„ç†ï¼š



```
#include <unistd.h>
#include <tbox/main/module.h>
#include <tbox/base/log.h>
#include <tbox/event/timer\_event.h>
#include <tbox/event/signal\_event.h> //! å¯¼å…¥SignalEvent

using namespace std::placeholders;

class MyModule : public tbox::main::Module {
  public:
    explicit MyModule(tbox::main::Context &ctx)
        : tbox::main::Module("my", ctx)
        , tick\_timer\_(ctx.loop()->newTimerEvent())
        , signal\_event\_(ctx.loop()->newSignalEvent())   //! å®ä¾‹åŒ–SignalEventå¯¹è±¡
    { }

    virtual ~MyModule() {
        delete signal_event_;   //! é‡Šæ”¾SignalEventå¯¹è±¡
        delete tick_timer_;
    }

  public:
    virtual bool onInit(const tbox::Json &js) override {
        tick_timer_->initialize(std::chrono::seconds(1), tbox::event::Event::Mode::kPersist);
        tick_timer_->setCallback([this] { onTick(); });

        //! åˆå§‹åŒ–SignalEventï¼Œä»¤å…¶åŒæ—¶ç›‘å¬SIGUSR1,SIGUSR2ä¿¡å·ï¼Œä¸”æ˜¯æŒç»­æœ‰æ•ˆ
        signal_event_->initialize({SIGUSR1, SIGUSR2}, tbox::event::Event::Mode::kPersist);
        //! è®¾ç½®å›è°ƒå‡½æ•°ï¼Œå‡æŒ‡å‘onSignalEvent()
        signal_event_->setCallback(std::bind(&MyModule::onSignalEvent, this, _1));
        return true;
    }
    virtual bool onStart() {
        tick_timer_->enable();
        signal_event_->enable(); //! ä½¿èƒ½SignalEvent
        return true;
    }
    virtual void onStop() {
        signal_event_->disable();
        tick_timer_->disable();  //! å…³é—­SignalEvent
    }

  private:
    void onTick() {
        ++count_;
        LogDbg("count:%d", count_);
    }

    //! ä¿¡å·äº‹ä»¶æ—¶çš„å¤„ç†
    void onSignalEvent(int signo) {
        LogInfo("got signal: %d", signo);
        if (signo == SIGUSR1)
            tick_timer_->disable(); //! å…³é—­å®šæ—¶å™¨
        else if (signo == SIGUSR2)
            tick_timer_->enable();  //! æ‰“å¼€å®šæ—¶å™¨
    }

  private:
    tbox::event::TimerEvent  \*tick_timer_;
    tbox::event::SignalEvent \*signal_event_;    //!< å®šä¹‰SignalEventå¯¹è±¡
    int count_ = 0;
};

namespace tbox {
namespace main {
void RegisterApps(Module &apps, Context &ctx) {
  apps.add(new MyModule(ctx));
}
}
}

```

ä¸€ä¸ªhttpæœåŠ¡ç¤ºä¾‹ï¼š



```
#include <tbox/main/module.h>
#include <tbox/base/log.h>
#include <tbox/http/server/server.h> //! å¯¼å…¥HttpæœåŠ¡

class MyModule : public tbox::main::Module {
  public:
    explicit MyModule(tbox::main::Context &ctx)
        : tbox::main::Module("my\_http", ctx)
        , http\_server\_(ctx.loop())  //! å®ä¾‹åŒ–HttpæœåŠ¡å¯¹è±¡
    { }

  public:
    virtual bool onInit(const tbox::Json &js) override {
        //! åˆå§‹åŒ–HttpæœåŠ¡ï¼Œç»‘å®š 0.0.0.0:12345 åœ°å€ï¼Œbacklogä¸º2
        if (!http_server_.initialize(tbox::network::SockAddr::FromString("0.0.0.0:12345"), 2))
            return false;

        //! æŒ‡å®šHttpæœåŠ¡çš„è¯·æ±‚çš„å¤„ç†æ–¹æ³•
        http_server_.use(
            [] (tbox::http::server::ContextSptr http_ctx,
                const tbox::http::server::NextFunc &next_func) {
                //! ä¸ç®¡è¯·æ±‚çš„æ˜¯ä»€ä¹ˆï¼Œç›´æ¥æŒ‡å®šå›å¤çš„bodyå†…å®¹
                http_ctx->res().body = R"(<p>Welcome to CppTbox.</br>This is http example.</p>)";
            }
        );

        return true;
    }
    virtual bool onStart() override {
        http_server_.start();   //! å¯åŠ¨HttpæœåŠ¡
        return true;
    }
    virtual void onStop() override {
        http_server_.stop();    //! åœæ­¢HttpæœåŠ¡
    }

  private:
    tbox::http::server::Server http_server_;    //! å®šä¹‰HttpæœåŠ¡å¯¹è±¡
};

namespace tbox {
namespace main {
void RegisterApps(Module &apps, Context &ctx) {
  apps.add(new MyModule(ctx));
}
}
}

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/6cbcd6c17cec4dba9bb3c0f895f02fa2.png)


ä»¥ä¸Šã€‚





