







> 
> ğŸ˜*â˜…,Â°*:.â˜†(ï¿£â–½ï¿£)/$:*.Â°â˜…* ğŸ˜  
>  è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»libmodbusé€šä¿¡åè®®åº“é…ç½®ä½¿ç”¨ã€‚  
>  **æ— ä¸“ç²¾åˆ™ä¸èƒ½æˆï¼Œæ— æ¶‰çŒåˆ™ä¸èƒ½é€šã€‚â€”â€”æ¢å¯è¶…**  
>  æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œä¸€èµ·å­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚  
>  å–œæ¬¢çš„æœ‹å‹å¯ä»¥å…³æ³¨ä¸€ä¸‹ï¼Œä¸‹æ¬¡æ›´æ–°ä¸è¿·è·¯ğŸ¥
> 
> 
> 




#### æ–‡ç« ç›®å½•


* + [:smirk:1. é¡¹ç›®ä»‹ç»](#smirk1__7)
	+ [:blush:2. ç¯å¢ƒé…ç½®](#blush2__25)
	+ [:satisfied:3. ä½¿ç”¨è¯´æ˜](#satisfied3__38)




### ğŸ˜1. é¡¹ç›®ä»‹ç»


å®˜ç½‘ï¼š`https://libmodbus.org/`


é¡¹ç›®Githubåœ°å€ï¼š`https://github.com/stephane/libmodbus`


`Libmodbus` æ˜¯ä¸€ä¸ªç”¨äºé€šä¿¡åè®® `Modbus` çš„`å¼€æº C è¯­è¨€åº“`ã€‚Modbus æ˜¯ä¸€ç§å¸¸ç”¨çš„å·¥ä¸šé€šä¿¡åè®®ï¼Œç”¨äºåœ¨è‡ªåŠ¨åŒ–è®¾å¤‡ä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢ã€‚Libmodbus æä¾›äº†ä¸€ç»„å‡½æ•°å’Œå·¥å…·ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿè½»æ¾åœ°å®ç° Modbus é€šä¿¡åŠŸèƒ½ã€‚


ä»¥ä¸‹æ˜¯ `Libmodbus` åº“çš„ä¸€äº›ä¸»è¦ç‰¹ç‚¹å’ŒåŠŸèƒ½ï¼š



> 
> 1.Modbus åè®®æ”¯æŒï¼šLibmodbus å®ç°äº† Modbus åè®®çš„åŸºæœ¬åŠŸèƒ½ï¼ŒåŒ…æ‹¬ Modbus RTUï¼ˆä¸²è¡Œï¼‰å’Œ Modbus TCPï¼ˆä»¥å¤ªç½‘ï¼‰ä¸¤ç§é€šä¿¡æ–¹å¼ã€‚å®ƒæ”¯æŒ Modbus ä¸»æœºå’Œä»æœºçš„é€šä¿¡ï¼Œä»¥åŠè¯»å–å’Œå†™å…¥ Modbus å¯„å­˜å™¨çš„æ“ä½œã€‚
> 
> 
> 



> 
> 2.è·¨å¹³å°æ”¯æŒï¼šLibmodbus æä¾›äº†è·¨å¹³å°çš„æ”¯æŒï¼Œå¯ä»¥åœ¨å¤šä¸ªæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼ŒåŒ…æ‹¬ Linuxã€Windowsã€macOS ç­‰ã€‚
> 
> 
> 



> 
> 3.ç®€å•æ˜“ç”¨ï¼šLibmodbus æä¾›äº†ç®€æ´çš„ APIï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ–¹ä¾¿åœ°é›†æˆ Modbus åŠŸèƒ½åˆ°ä»–ä»¬çš„åº”ç”¨ç¨‹åºä¸­ã€‚å®ƒæä¾›äº†ä¸€ç»„å‡½æ•°ï¼Œç”¨äºå»ºç«‹è¿æ¥ã€è¯»å†™å¯„å­˜å™¨ã€å¤„ç†å¼‚å¸¸ç­‰ã€‚
> 
> 
> 



> 
> 4.å¤šç§ç¼–ç¨‹è¯­è¨€æ”¯æŒï¼šè™½ç„¶ Libmodbus æ˜¯ä¸€ä¸ª C è¯­è¨€åº“ï¼Œä½†è¿˜æä¾›äº†å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ç»‘å®šï¼Œå¦‚ Pythonã€Java ç­‰ã€‚è¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ä»–ä»¬ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€æ¥ä½¿ç”¨ Libmodbusã€‚
> 
> 
> 


`Libmodbus` æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ Modbus åº“ï¼Œé€‚ç”¨äºå„ç§å·¥ä¸šè‡ªåŠ¨åŒ–å’Œç‰©è”ç½‘åº”ç”¨ã€‚


### ğŸ˜Š2. ç¯å¢ƒé…ç½®


ä¸‹é¢è¿›è¡Œç¯å¢ƒé…ç½®ï¼š



```
# aptå®‰è£…
sudo apt install libmodbus-dev

```


```
# ç¼–è¯‘
g++ -o main main.cpp  -lmodbus

```

### ğŸ˜†3. ä½¿ç”¨è¯´æ˜


ä¸‹é¢è¿›è¡Œä½¿ç”¨åˆ†æï¼š


Modbus RTUä¸²è¡Œè¯»å–å’Œå†™å…¥ç¤ºä¾‹ï¼š



```
#include <iostream>
#include <modbus/modbus.h>

int main() {
    modbus_t\* modbusContext;
    uint16\_t readBuffer[64];  // ç”¨äºå­˜å‚¨è¯»å–çš„æ•°æ®
    const int slaveId = 1;    // ä»æœº ID
    const int registerAddress = 0;  // å¯„å­˜å™¨åœ°å€
    const int numRegisters = 1;     // å¯„å­˜å™¨æ•°é‡
    const int coilAddress = 0;  // çº¿åœˆåœ°å€
    const int numCoils = 1;     // çº¿åœˆæ•°é‡

    // åˆå§‹åŒ– - è®¾å¤‡å·ã€æ³¢ç‰¹ç‡ã€æ ¡éªŒä½ã€æ•°æ®ä½ã€åœæ­¢ä½
    modbusContext = modbus\_new\_rtu("/dev/ttyUSB0", 9600, 'N', 8, 1);
    if (modbusContext == nullptr) {
        std::cerr << "Failed to create Modbus context" << std::endl;
        return 1;
    }

    // æ‰“å¼€ Modbus è¿æ¥
    if (modbus\_connect(modbusContext) == -1) {
        std::cerr << "Modbus connection failed: " << modbus\_strerror(errno) << std::endl;
        modbus\_free(modbusContext);
        return 1;
    }

    // è¯»å–å¯„å­˜å™¨
    int rc = modbus\_read\_registers(modbusContext, registerAddress, numRegisters, readBuffer);
    if (rc == -1) {
        std::cerr << "Failed to read Modbus registers: " << modbus\_strerror(errno) << std::endl;
    } else {
        std::cout << "Read value: " << readBuffer[0] << std::endl;
    }

    // å†™å…¥å¯„å­˜å™¨
    const uint16\_t writeValue = 1234;
    rc = modbus\_write\_register(modbusContext, registerAddress, writeValue);
    if (rc == -1) {
        std::cerr << "Failed to write Modbus register: " << modbus\_strerror(errno) << std::endl;
    } else {
        std::cout << "Write successful" << std::endl;
    }

    // è¯»å–çº¿åœˆçŠ¶æ€
    uint8\_t coilStatus;
    rc = modbus\_read\_bits(modbusContext, coilAddress, numCoils, &coilStatus);
    if (rc == -1) {
        std::cerr << "Failed to read Modbus coils: " << modbus\_strerror(errno) << std::endl;
    } else {
        std::cout << "Coil value: " << static\_cast<int>(coilStatus) << std::endl;
    }

    // å†™å…¥çº¿åœˆçŠ¶æ€
    const uint8\_t writeValue2 = 1;
    rc = modbus\_write\_bit(modbusContext, coilAddress, writeValue2);
    if (rc == -1) {
        std::cerr << "Failed to write Modbus coil: " << modbus\_strerror(errno) << std::endl;
    } else {
        std::cout << "Write successful" << std::endl;
    }

    // å…³é—­ Modbus è¿æ¥
    modbus\_close(modbusContext);
    modbus\_free(modbusContext);

    return 0;
}

```

Modbus TCPä»¥å¤ªç½‘è¯»å–å†™å…¥ç¤ºä¾‹ï¼š



```
#include <iostream>
#include <modbus/modbus.h>

int main() {
    modbus_t\* modbusContext;
    const char\* ipAddress = "192.168.1.100"; // Modbus TCP ä»æœºçš„ IP åœ°å€
    const int port = 502; // Modbus TCP ç«¯å£å·
    const int slaveId = 1; // ä»æœº ID

    modbusContext = modbus\_new\_tcp(ipAddress, port);
    if (modbusContext == nullptr) {
        std::cerr << "Failed to create Modbus context" << std::endl;
        return 1;
    }

    // æ‰“å¼€ Modbus è¿æ¥
    if (modbus\_connect(modbusContext) == -1) {
        std::cerr << "Modbus connection failed: " << modbus\_strerror(errno) << std::endl;
        modbus\_free(modbusContext);
        return 1;
    }

    // è¯»å–çº¿åœˆçŠ¶æ€
    const int coilAddress = 0; // çº¿åœˆåœ°å€
    const int numCoils = 1; // çº¿åœˆæ•°é‡
    uint8\_t coilStatus[numCoils];
    int rc = modbus\_read\_bits(modbusContext, coilAddress, numCoils, coilStatus);
    if (rc == -1) {
        std::cerr << "Failed to read Modbus coils: " << modbus\_strerror(errno) << std::endl;
    } else {
        std::cout << "Coil value: " << static\_cast<int>(coilStatus[0]) << std::endl;
    }

    // å†™å…¥çº¿åœˆçŠ¶æ€
    const uint8\_t writeValue = 1;
    rc = modbus\_write\_bit(modbusContext, coilAddress, writeValue);
    if (rc == -1) {
        std::cerr << "Failed to write Modbus coil: " << modbus\_strerror(errno) << std::endl;
    } else {
        std::cout << "Write successful" << std::endl;
    }

    // å…³é—­ Modbus è¿æ¥
    modbus\_close(modbusContext);
    modbus\_free(modbusContext);

    return 0;
}

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/6cbcd6c17cec4dba9bb3c0f895f02fa2.png)


ä»¥ä¸Šã€‚





