







> 
> ğŸ˜*â˜…,Â°*:.â˜†(ï¿£â–½ï¿£)/$:*.Â°â˜…* ğŸ˜  
>  è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»å¼€æºé¡¹ç›®â€”â€”Webæ–‡ä»¶æœåŠ¡å™¨ã€‚  
>  **æ— ä¸“ç²¾åˆ™ä¸èƒ½æˆï¼Œæ— æ¶‰çŒåˆ™ä¸èƒ½é€šã€‚ã€‚â€”â€”æ¢å¯è¶…**  
>  æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œä¸€èµ·å­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚  
>  å–œæ¬¢çš„æœ‹å‹å¯ä»¥å…³æ³¨ä¸€ä¸‹ï¼Œä¸‹æ¬¡æ›´æ–°ä¸è¿·è·¯ğŸ¥
> 
> 
> 




#### æ–‡ç« ç›®å½•


* + [:smirk:1. é¡¹ç›®ä»‹ç»](#smirk1__7)
	+ [:blush:2. å®‰è£…è¿è¡Œ](#blush2__24)
	+ [:satisfied:3. æºç åˆ†æ](#satisfied3__32)




### ğŸ˜1. é¡¹ç›®ä»‹ç»


é¡¹ç›®Githubåœ°å€ï¼š`https://github.com/shangguanyongshi/WebFileServer`


WebFileServeræ˜¯ä¸€ä¸ªåŸºäºWebçš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œå®ƒæä¾›äº†é€šè¿‡æµè§ˆå™¨è®¿é—®å’Œç®¡ç†æ–‡ä»¶çš„åŠŸèƒ½ã€‚ä½¿ç”¨WebFileServerï¼Œä½ å¯ä»¥åœ¨ä»»ä½•è®¾å¤‡ä¸Šé€šè¿‡ç½‘ç»œè½»æ¾ä¸Šä¼ ã€ä¸‹è½½ã€æŸ¥çœ‹å’Œç®¡ç†æ–‡ä»¶ã€‚


è¯¥é¡¹ç›®çš„åŠŸèƒ½ç‰¹ç‚¹æœ‰ï¼š



> 
> 1.æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ï¼šWebFileServerå…è®¸ç”¨æˆ·é€šè¿‡æµè§ˆå™¨ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ï¼Œå¹¶ä»æœåŠ¡å™¨ä¸Šä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°è®¾å¤‡ã€‚è¿™ä½¿å¾—æ–‡ä»¶ä¼ è¾“å˜å¾—ç®€å•æ–¹ä¾¿ï¼Œä¸éœ€è¦é¢å¤–çš„FTPå®¢æˆ·ç«¯æˆ–å…¶ä»–å·¥å…·ã€‚
> 
> 
> 



> 
> 2.æ–‡ä»¶ç®¡ç†ï¼šWebFileServeræä¾›äº†æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„ç®¡ç†åŠŸèƒ½ï¼Œä½ å¯ä»¥åˆ›å»ºã€åˆ é™¤æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚é€šè¿‡ç®€å•çš„æ“ä½œï¼Œä½ å¯ä»¥ç»„ç»‡å’Œç®¡ç†æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ç»“æ„ã€‚
> 
> 
> 



> 
> 3.å¤šç”¨æˆ·æ”¯æŒï¼šWebFileServeræ”¯æŒå¤šä¸ªç”¨æˆ·è´¦æˆ·ï¼Œå¹¶å…è®¸ä¸ºæ¯ä¸ªç”¨æˆ·é…ç½®ä¸åŒçš„æƒé™å’Œè®¿é—®çº§åˆ«ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥æ§åˆ¶ç”¨æˆ·å¯¹æ–‡ä»¶çš„è®¿é—®å’Œæ“ä½œæƒé™ï¼Œç¡®ä¿æ–‡ä»¶çš„å®‰å…¨æ€§å’Œéšç§æ€§ã€‚
> 
> 
> 



> 
> 4.ä¾¿æ·çš„ç•Œé¢ï¼šWebFileServeræä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„Webç•Œé¢ï¼Œä½¿å¾—æ–‡ä»¶çš„æµè§ˆå’Œæ“ä½œå˜å¾—ç›´è§‚å’Œæ˜“äºä½¿ç”¨ã€‚ä½ å¯ä»¥åœ¨æµè§ˆå™¨ä¸­é€šè¿‡ç®€å•çš„ç‚¹å‡»å’Œæ‹–æ”¾å®Œæˆæ–‡ä»¶æ“ä½œã€‚
> 
> 
> 



> 
> 5.å®‰å…¨æ€§å’Œæƒé™æ§åˆ¶ï¼šWebFileServeræ”¯æŒåŸºæœ¬çš„å®‰å…¨è®¤è¯å’Œæƒé™æ§åˆ¶æœºåˆ¶ï¼Œä¿æŠ¤æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å…å—æœªç»æˆæƒçš„è®¿é—®ã€‚ä½ å¯ä»¥è®¾ç½®ç”¨æˆ·çš„ç™»å½•å‡­æ®ï¼Œå¹¶ä¸ºæ¯ä¸ªç”¨æˆ·åˆ†é…ä¸åŒçš„è®¿é—®æƒé™ã€‚
> 
> 
> 


ç®€å•æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡httpåè®®å®ç°æ–‡ä»¶ä¸Šä¼ ã€æŸ¥çœ‹å’Œä¸‹è½½ã€åˆ é™¤æ“ä½œã€‚


### ğŸ˜Š2. å®‰è£…è¿è¡Œ


ç¼–è¯‘è¿è¡Œï¼š



```
make && ./main
# åœ¨æµè§ˆå™¨è¾“å…¥127.0.0.1:8888å³å¯è®¿é—®
# é»˜è®¤ipå’Œç«¯å£æ˜¯è¿™ä¸ªï¼Œå¯ä»¥ä¿®æ”¹ï¼Œéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šåšä¸ªç®€å•çš„æ–‡ä»¶å­˜å‚¨

```

### ğŸ˜†3. æºç åˆ†æ


ä¸‹é¢è¿›è¡Œæºç åˆ†æï¼š



> 
> ä½¿ç”¨ Reactor äº‹ä»¶å¤„ç†æ¨¡å‹ï¼Œé€šè¿‡ç»Ÿä¸€äº‹ä»¶æºï¼Œä¸»çº¿ç¨‹ä½¿ç”¨ epoll ç›‘å¬æ‰€æœ‰çš„äº‹ä»¶ï¼Œå·¥ä½œçº¿ç¨‹è´Ÿè´£æ‰§è¡Œäº‹ä»¶çš„é€»è¾‘å¤„ç†  
>  é¢„å…ˆåˆ›å»ºçº¿ç¨‹æ± ï¼Œå½“æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒåŠ å…¥çº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ä¸­ï¼Œä½¿ç”¨éšæœºé€‰æ‹©ç®—æ³•é€‰æ‹©çº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹å¤„ç†å·¥ä½œé˜Ÿåˆ—çš„äº‹ä»¶  
>  ä½¿ç”¨ HTTP GET æ–¹æ³•è·å–æ–‡ä»¶åˆ—è¡¨ï¼Œå‘èµ·ä¸‹è½½æ–‡ä»¶ã€åˆ é™¤æ–‡ä»¶çš„è¯·æ±‚ã€‚ä½¿ç”¨ POST æ–¹æ³•å‘æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶  
>  æœåŠ¡ç«¯ä½¿ç”¨æœ‰é™çŠ¶æ€æœºå¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œè§£æï¼Œæ ¹æ®è§£æç»“æœæ‰§è¡Œæ“ä½œåï¼Œå‘å®¢æˆ·ç«¯å‘é€é¡µé¢ã€å‘é€æ–‡ä»¶æˆ–å‘é€é‡å®šå‘æŠ¥æ–‡  
>  æœåŠ¡ç«¯ä½¿ç”¨ sendfile å‡½æ•°å®ç°é›¶æ‹·è´æ•°æ®å‘é€
> 
> 
> 


`filedir`æ˜¯æ–‡ä»¶å­˜å‚¨çš„ç›®å½•ã€‚


main.cpp



```
// ä½œè€…å·²ç»å¤‡æ³¨å¾ˆè¯¦ç»†äº†ï¼Œå³åˆ›å»ºçº¿ç¨‹æ± åï¼Œç›‘å¬å®¢æˆ·ç«¯çš„äº‹ä»¶è¯·æ±‚å¹¶å¤„ç†æ•°æ®
#include "./fileserver/fileserver.h"

int main(void){

    WebServer webserver;

    // åˆ›å»ºçº¿ç¨‹æ± 
    int ret = webserver.createThreadPool(4);
    if(ret != 0){
        std::cout << outHead("error") << "åˆ›å»ºçº¿ç¨‹æ± å¤±è´¥" << std::endl;
        return -1;
    }

    // åˆå§‹åŒ–ç”¨äºç›‘å¬çš„å¥—æ¥å­—
    int port = 8888;
    ret = webserver.createListenFd(port);
    if(ret != 0){
        std::cout << outHead("error") << "åˆ›å»ºå¹¶åˆå§‹åŒ–ç›‘å¬å¥—æ¥å­—å¤±è´¥" << std::endl;
        return -2;
    }

    // åˆå§‹åŒ–ç›‘å¬çš„epollä¾‹ç¨‹
    ret = webserver.createEpoll();
    if(ret != 0){
        std::cout << outHead("error") << "åˆå§‹åŒ–ç›‘å¬çš„epollä¾‹ç¨‹å¤±è´¥" << std::endl;
        return -3;
    }
    // å‘ epoll ä¸­æ·»åŠ ç›‘å¬å¥—æ¥å­—
    ret = webserver.epollAddListenFd();
    if(ret != 0){
        std::cout << outHead("error") << "epoll æ·»åŠ ç›‘å¬å¥—æ¥å­—å¤±è´¥" << std::endl;
        return -4;
    }

    // å¼€å¯ç›‘å¬å¹¶å¤„ç†è¯·æ±‚
    ret = webserver.waitEpoll();
    if(ret != 0){
        std::cout << outHead("error") << "epoll ä¾‹ç¨‹ç›‘å¬å¤±è´¥" << std::endl;
        return -5;
    }
    
    return 0;
}

```

threadpollï¼š



```
// çº¿ç¨‹æ± äº‹ä»¶å¤„ç†
// å‘äº‹ä»¶é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ªå¾…å¤„ç†çš„äº‹ä»¶ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¼šå¾ªç¯å¤„ç†å…¶ä¸­çš„äº‹ä»¶
int appendEvent(EventBase\* event, const std::string eventType);

```

eventï¼š



```
// äº‹ä»¶å¯¹è±¡å¤„ç†
// äº‹ä»¶åŸºç±»
class EventBase{
public:
    EventBase(){
    }
    virtual ~EventBase(){
    }
protected:
    // ä¿å­˜æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„è¯·æ±‚çš„çŠ¶æ€ï¼Œå› ä¸ºä¸€ä¸ªè¿æ¥ä¸Šçš„æ•°æ®å¯èƒ½éé˜»å¡ä¸€æ¬¡è¯»å–ä¸å®Œï¼Œæ‰€ä»¥ä¿å­˜åˆ°è¿™é‡Œï¼Œå½“è¯¥è¿æ¥ä¸Šæœ‰æ–°æ•°æ®æ—¶ï¼Œå¯ä»¥ç»§ç»­è¯»å–å¹¶å¤„ç†
    static std::unordered_map<int, Request> requestStatus;

    // ä¿å­˜æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å‘é€æ•°æ®çš„çŠ¶æ€ï¼Œä¸€æ¬¡procesä¸­éé˜»å¡çš„å†™æ•°æ®å¯èƒ½æ— æ³•å°†æ•°æ®å…¨éƒ¨ä¼ è¿‡å»ï¼Œæ‰€ä»¥ä¿å­˜å½“å‰æ•°æ®å‘é€çš„çŠ¶æ€ï¼Œå¯ä»¥ç»§ç»­ä¼ é€’æ•°æ®
    static std::unordered_map<int, Response> responseStatus;

public:
    // ä¸åŒç±»å‹äº‹ä»¶ä¸­é‡å†™è¯¥å‡½æ•°ï¼Œæ‰§è¡Œä¸åŒçš„å¤„ç†æ–¹æ³•
    virtual void process(){
    }
};
// æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥çš„äº‹ä»¶
// å¤„ç†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚
// å¤„ç†å‘å®¢æˆ·ç«¯å‘é€æ•°æ®

```

messageï¼š



```
// è¯·æ±‚æ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/6cbcd6c17cec4dba9bb3c0f895f02fa2.png)


ä»¥ä¸Šã€‚





