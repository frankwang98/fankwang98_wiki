







> 
> ğŸ˜*â˜…,Â°*:.â˜†(ï¿£â–½ï¿£)/$:*.Â°â˜…* ğŸ˜  
>  è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»LCMçš„é€šè®¯ã€‚  
>  **å­¦å…¶æ‰€ç”¨ï¼Œç”¨å…¶æ‰€å­¦ã€‚â€”â€”æ¢å¯è¶…**  
>  æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œä¸€èµ·å­¦ä¹ çŸ¥è¯†ï¼Œå…±åŒè¿›æ­¥ã€‚  
>  ğŸ¥å–œæ¬¢çš„æœ‹å‹å¯ä»¥å…³æ³¨ä¸€ä¸‹ï¼Œä¸‹æ¬¡æ›´æ–°ä¸è¿·è·¯ğŸ¥
> 
> 
> 




#### æ–‡ç« ç›®å½•


* + [:smirk:1. LCMé€šè®¯ä»‹ç»](#smirk1_LCM_7)
	+ [:blush:2. LCMå®‰è£…](#blush2_LCM_27)
	+ [:satisfied:3. LCMæ¡ˆä¾‹](#satisfied3_LCM_85)




### ğŸ˜1. LCMé€šè®¯ä»‹ç»


æœºå™¨äººé€šè®¯ä¸­æœ‰è®¸å¤šæµè¡Œçš„é€šè®¯ä¸­é—´ä»¶ï¼Œå¦‚ç™¾åº¦Apolloçš„`Cyber RT`ï¼ŒROS1ä¸­çš„`TCPROS/UDPROS`é€šä¿¡æœºåˆ¶ï¼ŒROS2ä¸­ä½¿ç”¨çš„`DDS`ç­‰ç­‰ã€‚ä¸‹é¢ä»‹ç»å¦ä¸€ç§é€šè®¯æ¨¡å—ï¼š


LCMé€šè®¯æ˜¯æŒ‡ä½¿ç”¨`Lightweight Communications and Marshalling (LCM)`æ¡†æ¶è¿›è¡Œæ¶ˆæ¯ä¼ é€’å’Œæ•°æ®ç¼–æ’çš„é€šä¿¡æ–¹å¼ã€‚LCMæ¡†æ¶æ—¨åœ¨æä¾›ä¸€ç§å¿«é€Ÿã€è½»é‡çº§å’Œçµæ´»çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼Œç”¨äºåœ¨å®æ—¶åº”ç”¨ç¨‹åºä¸­ä¼ è¾“å’Œå¤„ç†æ•°æ®ã€‚


LCMæä¾›äº†ç®€å•æ˜“ç”¨çš„APIï¼Œç”¨äºåœ¨è¿›ç¨‹ä¹‹é—´å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶æ”¯æŒæ•°æ®ç¼–æ’å’Œåºåˆ—åŒ–ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ç®€å•çš„æ¶ˆæ¯æè¿°è¯­è¨€`ï¼ˆMDLï¼‰`æ¥å®šä¹‰æ¶ˆæ¯çš„ç»“æ„å’Œæ•°æ®ç±»å‹ï¼Œä¸”æ”¯æŒå¤šç§è¯­è¨€`ï¼ˆC/C++ï¼ŒC#ï¼ŒJavaï¼ŒLuaï¼ŒMATLABï¼ŒPythonï¼‰`ã€‚


LCMçš„ä¸€ä¸ªå…³é”®ç‰¹ç‚¹æ˜¯å…¶é«˜æ•ˆæ€§ã€‚å®ƒä½¿ç”¨äºŒè¿›åˆ¶åè®®è¿›è¡Œæ¶ˆæ¯ä¼ è¾“ï¼Œä»è€Œé™ä½äº†å¤„ç†å¼€é”€å¹¶å‡å°‘äº†ç½‘ç»œå¸¦å®½çš„ä½¿ç”¨ã€‚æ­¤å¤–ï¼ŒLCMçš„æ¨¡å—åŒ–è®¾è®¡ä½¿å…¶æ˜“äºä¸ç°æœ‰ä»£ç åº“é›†æˆï¼Œå› æ­¤å¹¿æ³›åº”ç”¨äºæœºå™¨äººæŠ€æœ¯ã€èˆªç©ºèˆªå¤©ç­‰é¢†åŸŸã€‚


åœ¨æœºå™¨äººå’Œè‡ªåŠ¨é©¾é©¶ç³»ç»Ÿä¸­ï¼ŒLCMå¯ä»¥ä½œä¸ºROSçš„æ›¿ä»£å“ï¼Œç”¨äºå®Œæˆè¿›ç¨‹é—´ã€è®¾å¤‡é—´çš„é€šè®¯ã€‚


LCMå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š



> 
> 1. ä½å»¶è¿Ÿçš„è¿›ç¨‹é—´é€šä¿¡
> 2. ä½¿ç”¨UDPç»„æ’­çš„é«˜æ•ˆå¹¿æ’­æœºåˆ¶
> 3. ç±»å‹å®‰å…¨çš„æ¶ˆæ¯ç¼–æ’
> 4. ç”¨æˆ·å‹å¥½çš„è®°å½•å’Œå›æ”¾å·¥å…·
> 5. æ²¡æœ‰é›†ä¸­çš„ "æ•°æ®åº“ "æˆ– â€œæ¢çº½â€â€“èŠ‚ç‚¹é—´ç›´æ¥é€šè®¯
> 6. æ²¡æœ‰å®ˆæŠ¤è¿›ç¨‹
> 7. æå°‘çš„ä¾èµ–
> 
> 
> 


### ğŸ˜Š2. LCMå®‰è£…


githubåœ°å€ï¼š`https://github.com/lcm-proj/lcm/releases`


aptå®‰è£…ï¼š`sudo apt install liblcm-dev`


æºç å®‰è£…ï¼šè¿™é‡Œæˆ‘é€‰æ‹©`1.4.0`


å®‰è£…ä¾èµ–ï¼š`sudo apt-get install build-essential autoconf automake autopoint libglib2.0-dev libtool openjdk-8-jdk python-dev`


è‹¥å®‰è£…äº†å¤šä¸ªç‰ˆæœ¬çš„JAVAï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ‡æ¢åˆ°version 8ï¼š`sudo update-alternatives --config java`


ç¼–è¯‘å®‰è£…ï¼š



```
mkdir build
cd build
cmake ..
make
sudo make install

```

é…ç½®åŠ¨æ€åº“é“¾æ¥åœ°å€ï¼š



```
export LCM\_INSTALL\_DIR=/usr/local/lib
sudo sh -c "echo $LCM\_INSTALL\_DIR > /etc/ld.so.conf.d/lcm.conf"
sudo ldconfig

```

å®šä¹‰é€šè®¯æ•°æ®ç»“æ„ï¼ˆä½¿ç”¨lcmæ–‡ä»¶ï¼Œc++ä¸ºä¾‹ï¼‰ï¼Œåˆ›å»º`example_t.lcm`ï¼š



```
package exlcm;
struct example_t
{
    int64_t  timestamp;
    double   position[3];
    double   orientation[4]; 
    int32_t  num_ranges;
    int16_t  ranges[num_ranges];
    string   name;
    boolean  enabled;
}
struct nihao_t
{
    int64_t  timest2amp;
    string   name1;
    boolean  enabl1ed;
}

```

æ‰§è¡Œå‘½ä»¤ç”Ÿæˆå¤´æ–‡ä»¶ï¼š`lcm-gen -x example_t.lcm`ï¼ˆæ‰§è¡Œlcm-genåä¼šä¸ºæ¯ä¸€ä¸ªç»“æ„ä½“ç”Ÿæˆä¸€ä¸ªå¤´æ–‡ä»¶ã€‚ï¼‰


lcmå¸¸ç”¨å‘½ä»¤ï¼š



```
lcm-logger //è®°å½•log
lcm-spy //æŸ¥çœ‹å½“å‰æ•°æ®
lcm-logplayer, lcm-logplayer-gui //logå›æ”¾

```

### ğŸ˜†3. LCMæ¡ˆä¾‹


å‘é€ä»£ç ç¤ºä¾‹ï¼š



```
// file: send\_message.cpp
//
// LCM example program.
//
// compile with:
// $ g++ -o send\_message send\_message.cpp -llcm
//
// On a system with pkg-config, you can also use:
// $ g++ -o send\_message send\_message.cpp `pkg-config --cflags --libs lcm`

#include <lcm/lcm-cpp.hpp>

#include "exlcm/example\_t.hpp"

int main(int argc, char \*\*argv)
{
    lcm::LCM lcm;
    if (!lcm.good())
        return 1;

    exlcm::example_t my_data;
    my_data.timestamp = 0;

    my_data.position[0] = 1;
    my_data.position[1] = 2;
    my_data.position[2] = 3;

    my_data.orientation[0] = 1;
    my_data.orientation[1] = 0;
    my_data.orientation[2] = 0;
    my_data.orientation[3] = 0;

    my_data.num_ranges = 15;
    my_data.ranges.resize(my_data.num_ranges);
    for (int i = 0; i < my_data.num_ranges; i++)
        my_data.ranges[i] = i;

    my_data.name = "example string";
    my_data.enabled = true;

    lcm.publish("EXAMPLE", &my_data);

    return 0;
}

```

ç¼–è¯‘ï¼š`g++ -o send_message send_message.cpp -llcm`


æ¥æ”¶ä»£ç ç¤ºä¾‹ï¼š



```
// file: listener.cpp
//
// LCM example program.
//
// compile with:
// $ gcc -o listener listener.cpp -llcm
//
// On a system with pkg-config, you can also use:
// $ gcc -o listener listener.cpp `pkg-config --cflags --libs lcm`

#include <stdio.h>

#include <lcm/lcm-cpp.hpp>
#include "exlcm/example\_t.hpp"

class Handler {
  public:
    ~Handler() {}
    void handleMessage(const lcm::ReceiveBuffer \*rbuf, const std::string &chan,
                       const exlcm::example_t \*msg)
    {
        int i;
        printf("Received message on channel %s :n", chan.c\_str());
        printf(" timestamp = %lld\\n", (long long) msg->timestamp);
        printf(" position = (%f, %f, %f)\\n", msg->position[0], msg->position[1],
               msg->position[2]);
        printf(" orientation = (%f, %f, %f, %f)\\n", msg->orientation[0], msg->orientation[1],
               msg->orientation[2], msg->orientation[3]);
        printf(" ranges:");
        for (i = 0; i < msg->num_ranges; i++)
            printf(" %d", msg->ranges[i]);
        printf("\\n");
        printf(" name = '%s'\\n", msg->name.c\_str());
        printf(" enabled = %d\\n", msg->enabled);
    }
};

int main(int argc, char \*\*argv)
{
    lcm::LCM lcm;

    if (!lcm.good())
        return 1;

    Handler handlerObject;
    lcm.subscribe("EXAMPLE", &Handler::handleMessage, &handlerObject);

    while (0 == lcm.handle()) {
        // Do nothing
    }

    return 0;
}

```

ç¼–è¯‘ï¼š`g++ -o listener listener.cpp -llcm`


logæ•°æ®è§£æï¼š



```
// file: read\_log.cpp
//
// LCM example program. Demonstrates how to read and decode messages directly
// from a log file in C++. It is also possible to use the log file provider --
// see the documentation on the LCM class for details on that method.
//
// compile with:
// $ g++ -o read\_log read\_log.cpp -llcm
//
// On a system with pkg-config, you can also use:
// $ g++ -o read\_log read\_log.cpp `pkg-config --cflags --libs lcm`

#include <stdio.h>

#include <lcm/lcm-cpp.hpp>

#include "exlcm/example\_t.hpp"

int main(int argc, char \*\* argv)
{
    if(argc < 2) {
        fprintf(stderr, "usage: read\_log <logfile>\n");
        return 1;
    }

    // Open the log file.
    lcm::LogFile log(argv[1], "r");
    if(!log.good()) {
        perror("LogFile");
        fprintf(stderr, "couldn't open log file %s\n", argv[1]);
        return 1;
    }

    while(1) {
        // Read a log event.
        const lcm::LogEvent \*event = log.readNextEvent();
        if(!event)
            break;

        // Only process messages on the EXAMPLE channel.
        if(event->channel != "EXAMPLE")
            continue;

        // Try to decode the message.
        exlcm::example_t msg;
        if(msg.decode(event->data, 0, event->datalen) != event->datalen)
            continue;

        // Decode success! Print out the message contents.
        printf("Message:\n");
        printf(" timestamp = %lld\n", (long long)msg.timestamp);
        printf(" position = (%f, %f, %f)\n",
                msg.position[0], msg.position[1], msg.position[2]);
        printf(" orientation = (%f, %f, %f, %f)\n",
                msg.orientation[0], msg.orientation[1], msg.orientation[2],
                msg.orientation[3]);
        printf(" ranges:");
        for(int i = 0; i < msg.num_ranges; i++)
            printf(" %d", msg.ranges[i]);
        printf("\n");
        printf(" name = '%s'\n", msg.name.c\_str());
        printf(" enabled = %d\n", msg.enabled);
    }

    // Log file is closed automatically when the log variable goes out of
    // scope.

    printf("done\n");
    return 0;
}

```

ç¼–è¯‘ï¼š`g++ -o read_log read_log.cpp -llcm`


å‚è€ƒï¼š



```
https://mp.weixin.qq.com/s/P3TyCd7jYYd6a-EmSo8hAw
https://zhuanlan.zhihu.com/p/262727902

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/6567c240f1b5443ab60e194d3ffe3803.png)


ä»¥ä¸Šã€‚





